<html>
<head>
	<meta charset="utf-8">
	<title>Obinex Log</title>

	<link rel="stylesheet" href="static/css/bootstrap.css" />

	<script type="text/javascript" charset="utf-8">

var ws = new WebSocket("ws://" + location.hostname + ":12334/logws");
ws.onmessage = function(evt) {
	var msg = JSON.parse(evt.data);
	if (msg.LogLine) {
		var log = document.getElementById("log");
		var scroll = false;
		// If we are currently scrolled to the bottom, we are going to
		// scroll to bottom after adding the new line as well.
		if (log.scrollHeight - log.offsetHeight - log.scrollTop < 1) {
			scroll = true;
		}
		log.innerHTML += msg.LogLine;
		if (scroll) {
			log.scrollTop = log.scrollHeight;
		}
	}
	if (msg.Queue) {
		document.getElementById("queue").innerHTML = "";
		for (var i in msg.Queue) {
			document.getElementById("queue").innerHTML += "<li class='list-group-item'>" + msg.Queue[i] + "</li>\n";
		}
	}
	var warningBox = document.getElementById("warning-card")
	document.getElementById("warning-block").innerHTML = msg.Lock;
	if (msg.Lock) {
		warningBox.style.display = "block";
	} else {
		warningBox.style.display = "none";
	}
	if (msg.Mode) {
		var text = " (mode: ";
		if (msg.Mode == "batch") {
			text = "";
		} else {
			text = text + msg.Mode + ")";
		}
		document.getElementById("mode").innerHTML = text;
	}
};

	</script>
</head>
<body>
	<div class="container">
		{{template "content" .}}
	</div>
</body>
</html>
